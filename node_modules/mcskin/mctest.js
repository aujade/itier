var MCSkin = require("./mcskin.js");

var util = require("util");
function debug(obj){
  console.log(util.inspect(obj));
}
//debug(MCSkin);
var MCfg = require("../../config/mcskin");
MCSkin.init(MCfg.host, MCfg.port, MCfg.maxSockets);

const TEST_NUMBER = 1;
var count = 0;
/*
MCSkin.set("helo", "asd", function(err ,data){
  if(err){
    console.log(err);
  }else{
    console.log("set " + data);
  }

});
*/
var obj = { ti: '宝贝2, BEGIN{c81e728d9d4c2f636f067f89cc14862c} END',
            id: '2',
            pu: 'i2/3e0/610/T127pdXeqQA0JXXXXX.jpg' };

var val_str = JSON.stringify(obj);

function benchGet(){
	var start = new Date();
  var end;
  for(var i=0;i<TEST_NUMBER;i++){
    MCSkin.get(key_str,function(err ,data){
      count++;  
      if(err){
        console.log("test get err: " + err);
      }else{
        //console.log("data : " + data);
      }
      if(count >= TEST_NUMBER){
        end = new Date();
        console.log("time : " + (new Date() - start));
        console.log(data);

        MCSkin.delete("helo", function(err, data){
          MCSkin.destroy();
          if(err){
            console.log(err);
          }
        
        });
      }
    })
  }
}

/*
setInterval(function(){
 if(count <= TEST_NUMBER){
	 console.log("count : " + count);
 }
 console.log( "rss : " + process.memoryUsage().rss);
}, 10000);
*/

var key_str = "mysql:select * from meta_user_info where id =1";
key_str =  key_str.replace(/ /g, "%20");
console.log(key_str);
setTimeout(function(){
  MCSkin.set(key_str ,val_str ,function(err ,data){
    if(err)
    console.log(err);
    else 
    console.log("set ok");
  });

  
  benchGet();

}, 1000);
